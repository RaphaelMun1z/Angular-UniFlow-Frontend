<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <header class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Gerenciamento de Grupos</h1>
        <p class="text-gray-600 mt-1">Visualize, filtre e modere todas as turmas e grupos de estudo da plataforma.</p>
    </header>
    
    <main class="bg-white rounded-xl border border-gray-200 shadow-sm">
        <div class="p-4 border-b border-gray-200">
            <div *ngIf="selectedGroups.size === 0" class="flex flex-col md:flex-row items-center justify-between gap-4">
                <div class="relative w-full md:w-80">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>
                    </div>
                    <input type="text" placeholder="Buscar por título ou criador..." class="w-full pl-10 pr-4 py-2 text-sm border-gray-300 rounded-lg focus:ring-indigo-500">
                </div>
                <div class="flex items-center gap-2">
                    <button (click)="currentView = 'table'" [ngClass]="currentView === 'table' ? 'bg-gray-200 text-gray-800' : 'text-gray-500 hover:bg-gray-100'" class="p-2 rounded-md transition-colors"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg></button>
                    <button (click)="currentView = 'grid'" [ngClass]="currentView === 'grid' ? 'bg-gray-200 text-gray-800' : 'text-gray-500 hover:bg-gray-100'" class="p-2 rounded-md transition-colors"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 8.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25h2.25A2.25 2.25 0 0120.25 6v2.25a2.25 2.25 0 01-2.25 2.25h-2.25A2.25 2.25 0 0113.5 8.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25h2.25a2.25 2.25 0 012.25 2.25v2.25a2.25 2.25 0 01-2.25 2.25h-2.25a2.25 2.25 0 01-2.25-2.25v-2.25z" /></svg></button>
                </div>
            </div>
            <div *ngIf="selectedGroups.size > 0" class="flex items-center justify-between bg-indigo-50 p-2 rounded-lg">
                <span class="text-sm font-semibold text-indigo-800">{{ selectedGroups.size }} grupo(s) selecionado(s)</span>
                <div class="flex items-center space-x-2"><button class="px-3 py-1.5 text-sm font-semibold text-red-800 bg-red-100 rounded-md hover:bg-red-200">Excluir</button></div>
            </div>
        </div>
        
        <div class="overflow-x-auto">
            <div [ngSwitch]="currentView">
                
                <table *ngSwitchCase="'table'" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="p-4"><input type="checkbox" (change)="toggleSelectAll($event)" [checked]="areAllSelected()" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Grupo / Disciplina</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Criado por</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Membros</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Status</th>
                            <th scope="col" class="relative px-6 py-3"><span class="sr-only">Ações</span></th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr *ngIf="isLoading"><td colspan="6" class="text-center py-12 text-gray-500">Carregando grupos...</td></tr>
                        <tr *ngIf="!isLoading && grupos.length === 0"><td colspan="6" class="text-center py-12 text-gray-500">Nenhum grupo encontrado.</td></tr>
                        
                        <tr *ngFor="let grupo of grupos" class="hover:bg-gray-50" [class.bg-indigo-50]="selectedGroups.has(grupo.id)">
                            <td class="p-4"><input type="checkbox" (change)="toggleSelect(grupo.id)" [checked]="selectedGroups.has(grupo.id)" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"></td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center space-x-3">
                                    <div class="flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center" [ngClass]="grupo.tipo === 'Turma' ? 'bg-blue-100 text-blue-600' : 'bg-teal-100 text-teal-600'">
                                        <svg *ngIf="grupo.tipo === 'Turma'" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0012 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18" /></svg>
                                        <svg *ngIf="grupo.tipo === 'Grupo de Estudo'" class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962a3.75 3.75 0 015.25 0m-5.25 0a3.75 3.75 0 00-5.25 0M3 13.06l7.547 4.425A1.5 1.5 0 0012 16.5v8.25" /></svg>
                                    </div>
                                    <div>
                                        <p class="text-sm font-semibold text-gray-900">{{ grupo.titulo }}</p>
                                        <p class="text-sm text-gray-500">{{ grupo.disciplinaNome }}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center space-x-3">
                                    <img class="h-8 w-8 rounded-full" [src]="grupo.criadorAvatarUrl" alt="">
                                    <div>
                                        <p class="text-sm font-medium text-gray-900">{{ grupo.criadorNome }}</p>
                                        <p class="text-sm text-gray-500">{{ grupo.criadorEmail }}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700 text-center">{{ grupo.numMembros }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="text-xs font-semibold px-2.5 py-0.5 rounded-full" [ngClass]="grupo.statusClass">{{ grupo.status }}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <div class="relative inline-block text-left">
                                    <button (click)="openActionMenuId = (openActionMenuId === grupo.id ? null : grupo.id)" class="p-2 rounded-full text-gray-400 hover:bg-gray-100 hover:text-gray-600">
                                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" /></svg>
                                    </button>
                                    <div *ngIf="openActionMenuId === grupo.id"
                                    class="absolute right-0 mt-2 w-[calc(100vw-2.5rem)] max-w-xs sm:w-72 origin-top-right bg-white rounded-xl shadow-2xl border border-gray-200 z-10">
                                    <div class="p-2">
                                        
                                        <div>
                                            <a href="#" class="group flex items-start rounded-lg p-3 transition-colors hover:bg-gray-100">
                                                <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-indigo-100 text-indigo-600">
                                                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                                </div>
                                                <div class="ml-4">
                                                    <p class="text-sm font-semibold text-gray-900">Ver Detalhes</p>
                                                    <p class="text-sm text-gray-500">Acessar a página do grupo.</p>
                                                </div>
                                            </a>
                                            <a href="#" class="group flex items-start rounded-lg p-3 transition-colors hover:bg-gray-100">
                                                <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-indigo-100 text-indigo-600">
                                                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m-7.5-2.962a3.75 3.75 0 015.25 0m-5.25 0a3.75 3.75 0 00-5.25 0M3 13.06l7.547 4.425A1.5 1.5 0 0012 16.5v8.25" /></svg>
                                                </div>
                                                <div class="ml-4">
                                                    <p class="text-sm font-semibold text-gray-900">Ver Membros</p>
                                                    <p class="text-sm text-gray-500">Listar participantes do grupo.</p>
                                                </div>
                                            </a>
                                        </div>
                                        
                                        <div class="my-1 border-t border-gray-100"></div>
                                        
                                        <div>
                                            <a href="#" class="group flex items-start rounded-lg p-3 transition-colors hover:bg-gray-100">
                                                <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-gray-100 text-gray-600">
                                                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>
                                                </div>
                                                <div class="ml-4">
                                                    <p class="text-sm font-semibold text-gray-900">Editar Grupo</p>
                                                    <p class="text-sm text-gray-500">Alterar título e descrição.</p>
                                                </div>
                                            </a>
                                            <a href="#" class="group flex items-start rounded-lg p-3 transition-colors hover:bg-gray-100">
                                                <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-yellow-100 text-yellow-600">
                                                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /></svg>
                                                </div>
                                                <div class="ml-4">
                                                    <p class="text-sm font-semibold text-yellow-800">Desativar</p>
                                                    <p class="text-sm text-gray-500">Ocultar o grupo temporariamente.</p>
                                                </div>
                                            </a>
                                        </div>
                                        
                                        <div class="my-1 border-t border-gray-100"></div>
                                        
                                        <div>
                                            <a (click)="abrirModalExclusao(grupo)" class="cursor-pointer group flex items-start rounded-lg p-3 transition-colors hover:bg-red-50">
                                                <div class="flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-red-100 text-red-600">
                                                    <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.09-2.134H8.09a2.09 2.09 0 00-2.09 2.134v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg>
                                                </div>
                                                <div class="ml-4">
                                                    <p class="text-sm font-semibold text-red-700">Excluir Grupo</p>
                                                    <p class="text-sm text-gray-500">Esta ação é irreversível.</p>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div *ngSwitchCase="'grid'" class="p-6">
                <div *ngIf="isLoading" class="text-center py-12 text-gray-500">Carregando grupos...</div>
                <div *ngIf="!isLoading && grupos.length === 0" class="text-center py-12 text-gray-500">Nenhum grupo encontrado.</div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                    <div *ngFor="let grupo of grupos" class="bg-white rounded-lg border flex flex-col" [ngClass]="selectedGroups.has(grupo.id) ? 'border-indigo-400 ring-2 ring-indigo-200' : 'border-gray-200'">
                        <div class="p-4 flex justify-between items-start">
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" (change)="toggleSelect(grupo.id)" [checked]="selectedGroups.has(grupo.id)" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <div>
                                    <p class="text-sm font-semibold text-gray-900">{{ grupo.titulo }}</p>
                                    <p class="text-xs text-gray-500">{{ grupo.disciplinaNome }}</p>
                                </div>
                            </div>
                            <div class="relative">
                                <button (click)="openActionMenuId = (openActionMenuId === grupo.id ? null : grupo.id)" class="p-1 rounded-full text-gray-400 hover:bg-gray-100 hover:text-gray-600">
                                    <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" /></svg>
                                </button>
                                <div *ngIf="openActionMenuId === grupo.id" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 origin-top-right z-10">
                                </div>
                            </div>
                        </div>
                        <div class="px-4 pb-4 flex-grow">
                            <div class="flex items-center space-x-2">
                                <span class="text-xs font-semibold px-2 py-0.5 rounded-full" [ngClass]="grupo.statusClass">{{ grupo.status }}</span>
                                <span class="text-xs font-semibold px-2 py-0.5 rounded-full" [ngClass]="grupo.tipo === 'Turma' ? 'bg-blue-100 text-blue-800' : 'bg-teal-100 text-teal-800'">{{ grupo.tipo }}</span>
                            </div>
                        </div>
                        <div class="border-t border-gray-200 bg-gray-50/50 p-4 flex justify-between items-center text-sm">
                            <div class="flex items-center space-x-2">
                                <img class="h-6 w-6 rounded-full" [src]="grupo.criadorAvatarUrl" alt="">
                                <span class="text-gray-600">{{ grupo.criadorNome }}</span>
                            </div>
                            <span class="text-gray-500">{{ grupo.numMembros }} membros</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <footer *ngIf="!isLoading && totalPages > 1" class="flex items-center justify-between px-4 py-3 sm:px-6">
        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
            <div>
                <p class="text-sm text-gray-700">
                    Exibindo de <span class="font-medium">{{ (currentPage * pageSize) + 1 }}</span> a <span class="font-medium">{{ (currentPage * pageSize) + grupos.length }}</span> de <span class="font-medium">{{ totalElements }}</span> resultados
                </p>
            </div>
            <div>
                <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm">
                    <button (click)="paginaAnterior()" [disabled]="currentPage === 0" class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 disabled:opacity-50">Anterior</button>
                    <span class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300">Página {{ currentPage + 1 }} de {{ totalPages }}</span>
                    <button (click)="proximaPagina()" [disabled]="currentPage + 1 >= totalPages" class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 disabled:opacity-50">Próxima</button>
                </nav>
            </div>
        </div>
    </footer>
</main>
</div>

<div *ngIf="isDeleteModalOpen && selectedGroup" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 text-center">
        <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100">
            <svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" /></svg>
        </div>
        <h2 class="mt-4 text-2xl font-bold text-gray-900">Excluir Grupo</h2>
        <p class="mt-2 text-sm text-gray-500">Você tem certeza que deseja excluir o grupo <strong>"{{ selectedGroup.titulo }}"</strong>? Todos os dados associados serão perdidos. Esta ação é irreversível.</p>
        <div class="mt-6 flex justify-center space-x-3">
            <button (click)="fecharModalExclusao()" type="button" class="px-6 py-2 border border-gray-300 text-sm font-semibold text-gray-700 rounded-lg hover:bg-gray-100">Cancelar</button>
            <button (click)="confirmarExclusao()" class="bg-red-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-red-700">Excluir Grupo</button>
        </div>
    </div>
</div>